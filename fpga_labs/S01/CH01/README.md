# 1.1	按钮去抖动实验


## 实验要求

按键的消抖,按键在闭合或松开的瞬间伴随着一连串的抖动,理解按键消抖原理，完成编程。

## 按键消抖原理

按键每按一次，对应的 LED 灯反转一次。即检测按键是否有闭合和断开的过程，如果有，第一次则 LED 灯点亮，第二次，则 LED 灯熄灭。

由于按键固有的特性，在每次闭合和断开时，经过抖动-稳定-抖动-稳定的过程。因此，检测按键是否有按下的过程，则要进行两次消抖处理。
通过检测按键输入的值，当检测到 BTNC 为低电平时，启动计数器，做 10ms 延时，再检测一次，若 BTNC 依然为低，则说明， BTNC 被按下，设置按键按下标志位。
再次检测 BTNC，若 BTNC 为高电平，做 10ms 延时，第二次检测，若依然为高电平，则说明 BTNC 已断开，设置 BTNC 断开标志位，通过两个标志位，可以判断， BTNC 已经完
成了一次闭合到断开的过程，则 led 灯反转一次。

通过状态机的切换，按键每次由闭合到断开的过程中，分别产生 low 和 high，当这两个同时为高电平时，led 灯实现一次翻转。即第一次按键 led 高亮，第二次按键 led 熄灭。

## 程序分析

程序中定义了 div_cnt 计数器，实现 10ms 消抖延时操作；

程序中定义了 key_state 一段式状态机，该状态机包括 5 个状态。其中前 4 个为按键闭合与断开检测与消抖状态，在完成前 4 个状态后，通过 led 灯的翻转来表现按键的闭合与断开；

程序中定义了两个标志位，分别为 low_flag 和 high_flag。 low_flag 表示检测到按键按下，即按键闭合， high_flag 表示检测到按键弹起，即按键断开。当着两个标志为同时为 1 时，表示按键完
成一次闭合与断开；

程序中，对状态机做了循环，来回不停检测按键状态，且每次状态的切换时间是 10ms，状态的切换时间，也是按键消抖检测过程。

## 测试结果

按键 BTN0 每按一次， LED 灯很好地熄灭和点亮。 LED 灯响应无差错。为清晰的表示消抖的效果，可将延时参数设置很小，可以发现，按键有时候明明已经按下去了， LED 却无响应。
